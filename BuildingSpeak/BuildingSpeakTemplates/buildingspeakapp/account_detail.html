{% extends 'app_base.html' %}
{% block body %}

<script>
var charts = [];
function addChart(arr) {
  charts.push(arr);
};
</script>

<header>
  <h1>{{ account.name }}</h1>
</header>

<section class="entry">
  <div class="shortcode-tabs default" id="tabs-11">
    <ul class="tab_titles">
      <li class="nav-tab"><a href="#tab-1">Summary</a></li>
      <li class="nav-tab"><a href="#tab-3">Info</a></li>
      <li class="nav-tab"><a href="#tab-4">Data</a></li>
      <li class="nav-tab"><a href="#tab-5">Details</a></li>
    </ul> <!-- .nav-tabs -->

    <div class="tab tab-summary">
	{% for bldg, meter_data_curr, pie_data_curr, meter_data_prev, pie_data_prev in bldg_data %}
    <h2><a href="/{{ account.id }}/buildings/{{ bldg.id }}" title="{{ bldg.name }}">{{ bldg.name }}</a></h2>
    <div class="row">
		<div class="onecol-two prev">
	    {% if pie_data_prev %}
			  {% for cost_by_meter, cost_by_type, kBtu_by_meter, kBtu_by_type in pie_data_prev %}
			  <div id="{{ bldg.id }}-pie-cost-by-meter-prev" style="display: inline-block; width: 49%;"></div>
			  <script>
			  addChart([
				'{{ bldg.id }}-pie-cost-by-meter-prev',
				'PieChart',
				{{ cost_by_meter|safe }},
				{title: 'Cost by Meter - Previous Month'},
				'PieChart'
			  ]);
			  </script>
			  {% empty %}
				<div id="{{ bldg.id }}-pie-cost-by-meter-prev">{{ bldg.id }}-pie-cost-by-meter-prev2</div>
			  {% endfor %}
	    {% else %}
			<div id="{{ bldg.id }}-pie-cost-by-meter-prev" style="display: inline-block; width: 49%;">{{ bldg.id }}-pie-cost-by-meter-prev3</div>
		{% endif %}
	    {% if pie_data_curr %}
			  {% for cost_by_meter, cost_by_type, kBtu_by_meter, kBtu_by_type in pie_data_curr %}
			  <div id="{{ bldg.id }}-pie-cost-by-meter-curr" style="display: inline-block; width: 49%;"></div>
			  <script>
			  addChart([
				'{{ bldg.id }}-pie-cost-by-meter-curr',
				'PieChart',
				{{ cost_by_meter|safe }},
				{title: 'Cost by Meter - Latest Month'},
				'PieChart'
			  ]);
			  </script>
			  {% empty %}
				<div id="{{ bldg.id }}-pie-cost-by-meter-curr">{{ bldg.id }}-pie-cost-by-meter-curr2</div>
			  {% endfor %}
	    {% else %}
			<div id="{{ bldg.id }}-pie-cost-by-meter-curr" style="display: inline-block; width: 49%;">{{ bldg.id }}-pie-cost-by-meter-curr3</div>
		{% endif %}
	    {% if pie_data_prev %}
			  {% for cost_by_meter, cost_by_type, kBtu_by_meter, kBtu_by_type in pie_data_prev %}
			  <div id="{{ bldg.id }}-pie-cost-by-type-prev" style="display: inline-block; width: 49%;"></div>
			  <script>
			  addChart([
				'{{ bldg.id }}-pie-cost-by-type-prev',
				'PieChart',
				{{ cost_by_type|safe }},
				{title: 'Cost by Type - Previous Month'},
				'PieChart'
			  ]);
			  </script>
			  {% empty %}
				<div id="{{ bldg.id }}-pie-cost-by-type-prev">{{ bldg.id }}-pie-cost-by-type-prev2</div>
			  {% endfor %}
	    {% else %}
			<div id="{{ bldg.id }}-pie-cost-by-type-prev" style="display: inline-block; width: 49%;">{{ bldg.id }}-pie-cost-by-type-prev3</div>
		{% endif %}
	    {% if pie_data_curr %}
			  {% for cost_by_meter, cost_by_type, kBtu_by_meter, kBtu_by_type in pie_data_curr %}
			  <div id="{{ bldg.id }}-pie-cost-by-type-curr" style="display: inline-block; width: 49%;"></div>
			  <script>
			  addChart([
				'{{ bldg.id }}-pie-cost-by-type-curr',
				'PieChart',
				{{ cost_by_type|safe }},
				{title: 'Cost by Type - Latest Month'},
				'PieChart'
			  ]);
			  </script>
			  {% empty %}
				<div id="{{ bldg.id }}-pie-cost-by-type-curr">{{ bldg.id }}-pie-cost-by-type-curr2</div>
			  {% endfor %}
	    {% else %}
			<div id="{{ bldg.id }}-pie-cost-by-type-curr" style="display: inline-block; width: 49%;">{{ bldg.id }}-pie-cost-by-type-curr3</div>
		{% endif %}

		</div> <!-- .onecol-two -->
    </div> <!-- .row -->

    <div class="clear">
      <!-- TODO: Hide the hr after the last space -->
      <div class="woo-sc-hr"></div>
    </div>
    
	{% endfor %}
    </div> <!-- .tab-summary -->
    <div class="tab tab-info">

    </div> <!-- .tab-info -->
    <div class="tab tab-data">
      <p>
        <strong><u>Currently viewing:</u></strong>
        <input type="text" class="datepicker" />
        to
        <input type="text" class="datepicker" />
		<input type="submit" value="Refresh" />
		<input type="submit" value="Export" />
      </p>
	  
	  {% for utype, costu, consu, pdu, costd, consd, pdd, totals, ratios in meter_data %}
	  <div>{{ utype|safe }}</div>
	  <div id="{{ utype|safe }} - {{ forloop.counter0 }} - cost">{{ utype|safe }}</div>
	  <script>
      addChart([
        '{{ utype|safe }} - {{ forloop.counter0 }} - cost',
        'ComboChart',
        {{ costd|safe }},
        { // options
          title: 'Cost',
          vAxes: { 0: { title: '{{ costu|safe }}' } },
          seriesType: "bars",
          series:     {
            0: {type: "line", targetAxisIndex: 0, color: '#B88A00' },
            1: {type: "bar", targetAxisIndex: 0, color: '#003DF5' },
            2: {type: "bar", targetAxisIndex: 0, color: '#4271FF' },
            3: {type: "bar", targetAxisIndex: 0, color: '#009425' },
            4: {type: "bar", targetAxisIndex: 0, color: '#00E038' },
          }
        },
		'ComboChart'
      ]);
      </script>

	  <div id="{{ utype|safe }} - {{ forloop.counter0 }} - cons"></div>
	  <script>
      addChart([
        '{{ utype|safe }} - {{ forloop.counter0 }} - cons',
        'ComboChart',
        {{ consd|safe }},
        { // options
          title: 'Consumption',
          vAxes: { 0: { title: '{{ consu|safe }}' } },
          seriesType: "bars",
          series:     {
            0: {type: "line", targetAxisIndex: 0, color: '#B88A00' },
            1: {type: "bar", targetAxisIndex: 0, color: '#003DF5' },
            2: {type: "bar", targetAxisIndex: 0, color: '#4271FF' },
            3: {type: "bar", targetAxisIndex: 0, color: '#009425' },
            4: {type: "bar", targetAxisIndex: 0, color: '#00E038' },
          }
        },
		'ComboChart'
      ]);
      </script>

	  <div id="{{ utype|safe }} - {{ forloop.counter0 }} - pd"></div>
	  <script>
      addChart([
        '{{ utype|safe }} - {{ forloop.counter0 }} - pd',
        'ComboChart',
        {{ pdd|safe }},
        { // options
          title: 'Peak Demand',
          vAxes: { 0: { title: '{{ pdu|safe }}' } },
          seriesType: "bars",
          series:     {
            0: {type: "line", targetAxisIndex: 0, color: '#B88A00' },
            1: {type: "bar", targetAxisIndex: 0, color: '#003DF5' },
            2: {type: "bar", targetAxisIndex: 0, color: '#4271FF' },
            3: {type: "bar", targetAxisIndex: 0, color: '#009425' },
            4: {type: "bar", targetAxisIndex: 0, color: '#00E038' },
          }
        },
		'ComboChart'
      ]);
      </script>

	  Totals (over the period selected)
      <div id="{{ utype|safe }} - {{ forloop.counter0 }} - totals"></div>
      <script>
      addChart([
        '{{ utype|safe }} - {{ forloop.counter0 }} - totals',
        'Table',
        {{ totals|safe }},,
        { },
		'Table'
      ]);
      </script>
	  
	  Ratios (over the period selected)
      <div id="{{ utype|safe }} - {{ forloop.counter0 }} - ratios"></div>
      <script>
      addChart([
        '{{ utype|safe }} - {{ forloop.counter0 }} - ratios',
        'Table',
        {{ ratios|safe }},,
        { },
		'Table'
      ]);
      </script>
	  
	  <div class="clear">
        <div class="woo-sc-hr"></div>
      </div>

	  {% empty %}
	    <div id="{{ forloop.counter0 }}">No meter data available for bar charts and tables.</div>
	  {% endfor %}

	  {% for cost_by_meter, cost_by_type, kBtu_by_meter, kBtu_by_type in pie_data %}
	  <div id="{{ account.id }}-pie-cost-by-meter" style="display: inline-block; width: 49%;"></div>
	  <script>
	  addChart([
		'{{ account.id }}-pie-cost-by-meter',
		'PieChart',
		{{ cost_by_meter|safe }},
		{title: 'Cost by Meter'},
		'PieChart'
	  ]);
	  </script>
	  <div id="{{ account.id }}-pie-cost-by-type" style="display: inline-block; width: 49%;"></div>
	  <script>
	  addChart([
		'{{ account.id }}-pie-cost-by-type',
		'PieChart',
		{{ cost_by_type|safe }},
		{title: 'Cost by Utility Type'},
		'PieChart'
	  ]);
	  </script>
	  <div id="{{ account.id }}-pie-kBtu-by-meter" style="display: inline-block; width: 49%;"></div>
	  <script>
	  addChart([
		'{{ account.id }}-pie-kBtu-by-meter',
		'PieChart',
		{{ kBtu_by_meter|safe }},
		{title: 'kBtu by Meter'},
		'PieChart'
	  ]);
	  </script>
	  <div id="{{ account.id }}-pie-kBtu-by-type" style="display: inline-block; width: 49%;"></div>
	  <script>
	  addChart([
		'{{ account.id }}-pie-kBtu-by-type',
		'PieChart',
		{{ kBtu_by_type|safe }},
		{title: 'kBtu by Utility Type'},
		'PieChart'
	  ]);
	  </script>

	  {% empty %}
	    <div id="{{ forloop.counter0 }}">No meter data available for pie charts.</div>
	  {% endfor %}

	  
    </div> <!-- .tab-data -->
    <div class="tab tab-details">
      <div id="model-details"></div>
      <script>
      addChart([
        'model-details',
        'Table',
		{{ account_attrs|safe }},
        { },
		'Table'
      ]);
      </script>
    </div> <!-- .tab-details -->

</section> <!-- .entry -->

<script type="text/javascript">
google.load("visualization", "1", {packages:["corechart","table"]});
google.setOnLoadCallback(function() {
  for (var i=0; i<charts.length; i++) {
    var chart = charts[i];
    drawChart.apply(this, chart);
  }
});
function drawChart(id, chartType, data, options, dtType) {
  var el = document.getElementById(id);
  //var dataTable = google.visualization.arrayToDataTable(data);
  if (dtType == 'BarWithErrors')
    {
     var dataTable = new google.visualization.DataTable();
     dataTable.addColumn('string', 'Month'); // Implicit domain column.
     dataTable.addColumn('number', 'Sales'); // Implicit data column.
     dataTable.addColumn({type:'number', role:'interval'});
     dataTable.addColumn({type:'number', role:'interval'});
     dataTable.addColumn({type:'string', role:'annotation'});
     dataTable.addColumn({type:'string', role:'annotationText'});
	 dataTable.addColumn('number', 'Expenses');
     dataTable.addRows(data);
     }
  else
    {
	 var dataTable = google.visualization.arrayToDataTable(data);	 
	 }
  var chart     = new google.visualization[chartType](el);
  chart.draw(dataTable, options);
}

</script>
{% endblock %}
